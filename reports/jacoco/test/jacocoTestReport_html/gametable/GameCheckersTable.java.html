<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GameCheckersTable.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">dama</a> &gt; <a href="index.source.html" class="el_package">gametable</a> &gt; <span class="el_source">GameCheckersTable.java</span></div><h1>GameCheckersTable.java</h1><pre class="source lang-java linenums">package gametable;

import game.Game;
import gametable.components.Checker;
import gametable.components.CheckersComponent;
import player.Player;

/**
 * &lt;&lt;Control&gt;&gt;
 * 
 * Contiene i metodi necessari alle mosse
 *
 */
public class GameCheckersTable extends CheckersTable {
	private static final char MOVE_SEPARATOR = '-';
    private static final char TAKE_SEPARATOR = 'x';

    private static final int NOT_VALID_CELL = -1;

    private int blackCheckers;
    private int whiteCheckers;

    private static final int UPPER_LEFT_CELL = 0;
    private static final int UPPER_RIGHT_CELL = 1;
    private static final int LOWER_LEFT_CELL = 2;
    private static final int LOWER_RIGHT_CELL = 3;

    private static final int MOVE_TYPE = 1;
    private static final int SIMPLE_TAKE_TYPE = 2;
    private static final int DOUBLE_TAKE_TYPE = 3;

    public GameCheckersTable() {
<span class="fc" id="L33">        super();</span>
<span class="fc" id="L34">        blackCheckers = CHECKERS_NUMBER;</span>
<span class="fc" id="L35">        whiteCheckers = CHECKERS_NUMBER;</span>
<span class="fc" id="L36">    }</span>

    protected  GameCheckersTable(final boolean empty) {
<span class="fc" id="L39">        super(empty);</span>
<span class="fc" id="L40">        blackCheckers = 0;</span>
<span class="fc" id="L41">        whiteCheckers = 0;</span>
<span class="fc" id="L42">    }</span>

    public static int getNotValidCell() {
<span class="nc" id="L45">    	return NOT_VALID_CELL;</span>
    }

    public final int getBlackCheckers() {
<span class="nc" id="L49">        return blackCheckers;</span>
    }

    public final void setBlackCheckers(final int value) {
<span class="fc" id="L53">    	this.blackCheckers = value;</span>
<span class="fc" id="L54">    }</span>

    public final int getWhiteCheckers() {
<span class="nc" id="L57">        return whiteCheckers;</span>
    }

    public final void setWhiteCheckers(final int value) {
<span class="fc" id="L61">    	this.whiteCheckers = value;</span>
<span class="fc" id="L62">    }</span>

    public final char getMoveSeparator() {
<span class="fc" id="L65">        return MOVE_SEPARATOR;</span>
    }
    public final char getTakeSeparator() {
<span class="nc" id="L68">        return TAKE_SEPARATOR;</span>
    }

    public static final int getMoveType() {
<span class="fc" id="L72">        return MOVE_TYPE;</span>
    }

    public static final int getSimpleTakeType() {
<span class="fc" id="L76">        return SIMPLE_TAKE_TYPE;</span>
    }

    public static final int getDoubleTakeType() {
<span class="fc" id="L80">        return DOUBLE_TAKE_TYPE;</span>
    }

    protected final int[] getNumbersCells(final String userInput, final char symbol) {

<span class="fc" id="L85">        String[] nums = userInput.split(Character.toString(symbol));</span>
<span class="fc" id="L86">        int[] numbers = new int[nums.length];</span>

<span class="fc" id="L88">        int i = 0;</span>

<span class="fc bfc" id="L90" title="All 2 branches covered.">        for (String s : nums) {</span>
<span class="fc" id="L91">            numbers[i] = Integer.parseInt(s);</span>
<span class="fc" id="L92">            i++;</span>
        }

<span class="fc" id="L95">        return numbers;</span>

    }

    private boolean validInputNumbers(final int[] numbers) {

<span class="fc" id="L101">        boolean valid = true;</span>
<span class="fc" id="L102">        int i = 0;</span>

<span class="pc bpc" id="L104" title="1 of 4 branches missed.">        while (i &lt; numbers.length &amp;&amp; valid) {</span>

<span class="pc bpc" id="L106" title="2 of 4 branches missed.">            if (numbers[i] &lt; 1 || numbers[i] &gt; LAST_CELL_NUMBER) {</span>
<span class="nc" id="L107">                valid = false;</span>
            }

<span class="pc bpc" id="L110" title="1 of 2 branches missed.">            if (numbers[i] == 0) {</span>
<span class="nc" id="L111">                continue;</span>
            }

<span class="fc" id="L114">            i++;</span>
        }
<span class="fc" id="L116">        return valid;</span>
    }

    private int[] getCoordinates(final int blackCellNumber) {

<span class="fc" id="L121">        int[] xy = new int[2];</span>
<span class="fc" id="L122">        boolean found = false;</span>

<span class="fc" id="L124">        int i = 0;</span>

<span class="fc bfc" id="L126" title="All 4 branches covered.">        while (i &lt; TABLE_ROWS &amp;&amp; !found) {</span>
<span class="fc" id="L127">            int j = 0;</span>

<span class="fc bfc" id="L129" title="All 4 branches covered.">            while (j &lt; TABLE_COLUMNS &amp;&amp; !found) {</span>

<span class="fc bfc" id="L131" title="All 2 branches covered.">                if (super.getCellTable(i, j).getNumber() == blackCellNumber) {</span>
<span class="fc" id="L132">                    xy[0] = i;</span>
<span class="fc" id="L133">                    xy[1] = j;</span>

<span class="fc" id="L135">                    found = true;</span>
                }

<span class="fc" id="L138">                j++;</span>
            }
<span class="fc" id="L140">            i++;</span>
<span class="fc" id="L141">        }</span>
<span class="fc" id="L142">        return xy;</span>
    }

    private boolean validInputNumber(final int cellNumber) {

<span class="fc" id="L147">        boolean valid = false;</span>

<span class="fc bfc" id="L149" title="All 4 branches covered.">        if (cellNumber &gt;= 1 &amp;&amp; cellNumber &lt;= LAST_CELL_NUMBER) {</span>

<span class="fc" id="L151">            valid = true;</span>
        }
<span class="fc" id="L153">        return valid;</span>
    }

    private boolean diagonalControlChecker(final int start, final int end, final Player mover) {

<span class="fc" id="L158">        boolean control = false;</span>

<span class="fc" id="L160">        int[] startCoord = getCoordinates(start);</span>
<span class="fc" id="L161">        int[] endCoord = getCoordinates(end);</span>
<span class="fc" id="L162">        Checker startChecker = super.getCellTable(startCoord[0], startCoord[1]).getOccupierChecker();</span>

<span class="pc bpc" id="L164" title="1 of 2 branches missed.">        if (startChecker != null) {</span>

<span class="fc" id="L166">            int nextRow = 1;</span>
<span class="fc" id="L167">            int nextColumn = 1;</span>

<span class="fc bfc" id="L169" title="All 4 branches covered.">            if (mover.getColor() == Game.getWhiteColor() &amp;&amp; !startChecker.isBigChecker()) {</span>

<span class="fc" id="L171">                nextRow = -1;</span>
            }

            /*
             * controllo che la colonna della cella in cui mi muovo sia a destra o a
             * sinistra della colonna della cella selezionata
             */
<span class="pc bpc" id="L178" title="1 of 4 branches missed.">            if (endCoord[1] == startCoord[1] + nextColumn || endCoord[1] == startCoord[1] - nextColumn) {</span>

<span class="fc bfc" id="L180" title="All 2 branches covered.">                if (!startChecker.isBigChecker()) {</span>

<span class="pc bpc" id="L182" title="1 of 2 branches missed.">                    if (endCoord[0] == startCoord[0] + nextRow) {</span>
<span class="fc" id="L183">                        control = true;</span>
                    }

                } else {

<span class="pc bpc" id="L188" title="1 of 4 branches missed.">                    if (endCoord[0] == startCoord[0] + nextRow || endCoord[0] == startCoord[0] - nextRow) {</span>

<span class="fc" id="L190">                        control = true;</span>
                    }
                }
            }
        }
<span class="fc" id="L195">        return control;</span>
    }

    private CheckersComponent getNextDiagonalCell(final int startCell, final int direction) {

<span class="fc" id="L200">        CheckersComponent diagonalCell = null;</span>

<span class="fc" id="L202">        int[] startCoord = getCoordinates(startCell);</span>

<span class="pc bpc" id="L204" title="1 of 2 branches missed.">        if (validInputNumber(startCell)) {</span>

<span class="fc" id="L206">            int rowIndex = startCoord[0];</span>
<span class="fc" id="L207">            int numberDiagonalCell = -1;</span>

<span class="fc" id="L209">            final int[] directions = {-5, -4, 3, 4, 5, -3};</span>
<span class="fc" id="L210">            final int index3 = 3;</span>
<span class="fc" id="L211">            final int index4 = 4;</span>
<span class="fc" id="L212">            final int index5 = 5;</span>

<span class="fc" id="L214">            int getUpperLeftCell = directions[0];</span>
<span class="fc" id="L215">            int getUpperRightCell = directions[1];</span>
<span class="fc" id="L216">            int getLowerLeftCell = directions[2];</span>
<span class="fc" id="L217">            int getLowerRightCell = directions[index3];</span>

            // l'indice della riga e' pari
<span class="fc bfc" id="L220" title="All 2 branches covered.">            if (rowIndex % 2 != 0) {</span>

<span class="fc" id="L222">                getUpperLeftCell = directions[1];</span>
<span class="fc" id="L223">                getUpperRightCell = directions[index5];</span>
<span class="fc" id="L224">                getLowerLeftCell = directions[index3];</span>
<span class="fc" id="L225">                getLowerRightCell = directions[index4];</span>
            }

<span class="fc bfc" id="L228" title="All 2 branches covered.">            if (direction == UPPER_LEFT_CELL) {</span>
<span class="fc" id="L229">                numberDiagonalCell = startCell + getUpperLeftCell;</span>
            }

<span class="fc bfc" id="L232" title="All 2 branches covered.">            if (direction == UPPER_RIGHT_CELL) {</span>
<span class="fc" id="L233">                numberDiagonalCell = startCell + getUpperRightCell;</span>
            }

<span class="fc bfc" id="L236" title="All 2 branches covered.">            if (direction == LOWER_LEFT_CELL) {</span>
<span class="fc" id="L237">                numberDiagonalCell = startCell + getLowerLeftCell;</span>
            }

<span class="fc bfc" id="L240" title="All 2 branches covered.">            if (direction == LOWER_RIGHT_CELL) {</span>
<span class="fc" id="L241">                numberDiagonalCell = startCell + getLowerRightCell;</span>
            }

<span class="fc bfc" id="L244" title="All 2 branches covered.">            if (validInputNumber(numberDiagonalCell)) {</span>

<span class="fc" id="L246">                diagonalCell = getCell(numberDiagonalCell);</span>
            }
        }
<span class="fc" id="L249">        return diagonalCell;</span>
    }

    protected final CheckersComponent getCell(final int cellNumber) {

        CheckersComponent selectedCell;
<span class="fc" id="L255">        int[] coordCell = getCoordinates(cellNumber);</span>

<span class="fc" id="L257">        selectedCell = super.getCellTable(coordCell[0], coordCell[1]);</span>
<span class="fc" id="L258">        return selectedCell;</span>
    }

    private boolean moveCheckersControl(final int start, final int end, final Player mover) {

<span class="fc" id="L263">        boolean control = false;</span>

<span class="fc" id="L265">        CheckersComponent startCell = getCell(start);</span>
<span class="fc" id="L266">        CheckersComponent endCell = getCell(end);</span>

<span class="pc bpc" id="L268" title="1 of 2 branches missed.">        if (diagonalControlChecker(start, end, mover)) {</span>

<span class="pc bpc" id="L270" title="2 of 4 branches missed.">            if (startCell.getOccupierChecker() != null &amp;&amp; endCell.getOccupierChecker() == null) {</span>

<span class="fc" id="L272">                Checker movedChecker = startCell.getOccupierChecker();</span>

<span class="pc bpc" id="L274" title="1 of 2 branches missed.">                if (mover.getColor() == movedChecker.getColor()) {</span>
<span class="fc" id="L275">                    control = true;</span>
                }
            }
        }
<span class="fc" id="L279">        return control;</span>
    }

    private void setBigCheckerTable(final int endCell, final Checker movedChecker) {

<span class="pc bpc" id="L284" title="2 of 4 branches missed.">        if (validInputNumber(endCell) &amp;&amp; movedChecker != null) {</span>

<span class="pc bpc" id="L286" title="1 of 2 branches missed.">            if (!movedChecker.isBigChecker()) {</span>

<span class="fc" id="L288">                char bigSymbol = BIG_BLACK_CHECKER;</span>

<span class="fc bfc" id="L290" title="All 2 branches covered.">                if (movedChecker.getColor() == Game.getWhiteColor()) {</span>
<span class="fc" id="L291">                    bigSymbol = BIG_WHITE_CHECKER;</span>
                }

<span class="fc" id="L294">                final int validNum1 = 1;</span>
<span class="fc" id="L295">                final int validNum2 = 4;</span>
<span class="fc" id="L296">                final int validNum3 = 29;</span>
<span class="fc" id="L297">                final int validNum4 = LAST_CELL_NUMBER;</span>

<span class="pc bpc" id="L299" title="5 of 8 branches missed.">                if ((endCell &gt;= validNum1 &amp;&amp; endCell &lt;= validNum2) || (endCell &gt;= validNum3 &amp;&amp; endCell &lt;= validNum4)) {</span>

<span class="nc" id="L301">                    movedChecker.setBigChecker(true);</span>
<span class="nc" id="L302">                    movedChecker.setSymbol(bigSymbol);</span>
                }
            }
        }
<span class="fc" id="L306">    }</span>

    private int moveCheckers(final int start, final int end, final Player mover) {

<span class="fc" id="L310">        int endCellNumber = NOT_VALID_CELL;</span>

<span class="fc" id="L312">        CheckersComponent startCell = getCell(start);</span>
<span class="fc" id="L313">        CheckersComponent endCell = getCell(end);</span>

<span class="pc bpc" id="L315" title="1 of 2 branches missed.">        if (moveCheckersControl(start, end, mover)) {</span>

<span class="fc" id="L317">            Checker movedChecker = startCell.getOccupierChecker();</span>
<span class="fc" id="L318">            endCell.setOccupierChecker(movedChecker);</span>
<span class="fc" id="L319">            startCell.setOccupierChecker(null);</span>

<span class="fc" id="L321">            setBigCheckerTable(end, movedChecker);</span>
<span class="fc" id="L322">            endCellNumber = end;</span>
        }
<span class="fc" id="L324">        String movement = start + &quot;-&quot; + end;</span>
<span class="fc" id="L325">        mover.setMoves(movement);</span>

<span class="fc" id="L327">        return endCellNumber;</span>
    }

    private boolean moveBigCheckerControl(final int start, final int end, final Player mover) {

<span class="fc" id="L332">        boolean control = false;</span>

<span class="fc" id="L334">        CheckersComponent startCell = getCell(start);</span>
<span class="fc" id="L335">        CheckersComponent endCell = getCell(end);</span>

<span class="pc bpc" id="L337" title="1 of 2 branches missed.">        if (diagonalControlChecker(start, end, mover)) {</span>

<span class="fc" id="L339">            Checker movedChecker = startCell.getOccupierChecker();</span>

<span class="pc bpc" id="L341" title="2 of 4 branches missed.">            if (movedChecker != null &amp;&amp; endCell.getOccupierChecker() == null) {</span>

<span class="pc bpc" id="L343" title="2 of 4 branches missed.">                if (movedChecker.isBigChecker() &amp;&amp; movedChecker.getColor() == mover.getColor()) {</span>
<span class="fc" id="L344">                    control = true;</span>
                }

            }
        }
<span class="fc" id="L349">        return control;</span>
    }

    public final int moveCheckers(final String input, final Player mover) {

<span class="fc" id="L354">        int endCellNumber = NOT_VALID_CELL;</span>
<span class="fc" id="L355">        int[] cellNumbers = getNumbersCells(input, MOVE_SEPARATOR);</span>

<span class="pc bpc" id="L357" title="1 of 2 branches missed.">        if (validInputNumbers(cellNumbers)) {</span>

<span class="pc bpc" id="L359" title="1 of 2 branches missed.">            if (moveCheckersControl(cellNumbers[0], cellNumbers[1], mover)) {</span>

<span class="fc" id="L361">                Checker movedChecker = getCell(cellNumbers[0]).getOccupierChecker();</span>

<span class="fc bfc" id="L363" title="All 2 branches covered.">                if (!movedChecker.isBigChecker()) {</span>

<span class="fc" id="L365">                    endCellNumber = moveCheckers(cellNumbers[0], cellNumbers[1], mover);</span>
                } else {
<span class="fc" id="L367">                    endCellNumber = moveBigCheckers(cellNumbers[0], cellNumbers[1], mover);</span>
                }

            }
        }
<span class="fc" id="L372">        return endCellNumber;</span>
    }

    private int moveBigCheckers(final int start, final int end, final Player mover) {

<span class="fc" id="L377">        int endCellNumber = NOT_VALID_CELL;</span>

<span class="fc" id="L379">        CheckersComponent startCell = getCell(start);</span>
<span class="fc" id="L380">        CheckersComponent endCell = getCell(end);</span>

<span class="pc bpc" id="L382" title="1 of 2 branches missed.">        if (moveBigCheckerControl(start, end, mover)) {</span>

<span class="fc" id="L384">            Checker movedChecker = startCell.getOccupierChecker();</span>

<span class="fc" id="L386">            endCell.setOccupierChecker(movedChecker);</span>
<span class="fc" id="L387">            startCell.setOccupierChecker(null);</span>
<span class="fc" id="L388">            endCellNumber = end;</span>
        }
<span class="fc" id="L390">        String movement = start + &quot;-&quot; + end;</span>
<span class="fc" id="L391">        mover.setMoves(movement);</span>

<span class="fc" id="L393">        return endCellNumber;</span>
    }

    private int checkerSimpleTakeControl(final int start, final int end, final Player current) {

<span class="fc" id="L398">        int numberEatenCheckerCell = NOT_VALID_CELL;</span>

<span class="fc" id="L400">        CheckersComponent startCell = getCell(start);</span>
<span class="fc" id="L401">        CheckersComponent endCell = getCell(end);</span>
<span class="fc" id="L402">        Checker movedChecker = startCell.getOccupierChecker();</span>

<span class="pc bpc" id="L404" title="2 of 4 branches missed.">        if (movedChecker != null &amp;&amp; endCell.getOccupierChecker() == null) {</span>

<span class="pc bpc" id="L406" title="1 of 2 branches missed.">            if (movedChecker.getColor() == current.getColor()) {</span>

<span class="fc" id="L408">                CheckersComponent eatenCheckerCell = null;</span>
<span class="fc" id="L409">                int leftDirection = LOWER_LEFT_CELL;</span>
<span class="fc" id="L410">                int rightDirection = LOWER_RIGHT_CELL;</span>

<span class="fc bfc" id="L412" title="All 2 branches covered.">                if (current.getColor() == Game.getWhiteColor()) {</span>

<span class="fc" id="L414">                    leftDirection = UPPER_LEFT_CELL;</span>
<span class="fc" id="L415">                    rightDirection = UPPER_RIGHT_CELL;</span>
                }

<span class="fc" id="L418">                final int numberPossibleCells = 2;</span>

<span class="fc" id="L420">                CheckersComponent[] possibleCells = new CheckersComponent[numberPossibleCells];</span>
<span class="fc" id="L421">                CheckersComponent[] possibleNextCells = new CheckersComponent[numberPossibleCells];</span>

<span class="fc" id="L423">                possibleCells[0] = getNextDiagonalCell(start, leftDirection);</span>
<span class="fc" id="L424">                possibleCells[1] = getNextDiagonalCell(start, rightDirection);</span>

<span class="fc bfc" id="L426" title="All 2 branches covered.">                for (int i = 0; i &lt; possibleCells.length; i++) {</span>

<span class="pc bpc" id="L428" title="1 of 2 branches missed.">                    if (possibleCells[i] != null) {</span>

<span class="fc bfc" id="L430" title="All 2 branches covered.">                        if (i == 0) {</span>

<span class="fc" id="L432">                            possibleNextCells[i] = getNextDiagonalCell(possibleCells[i].getNumber(), leftDirection);</span>
                        }

<span class="fc bfc" id="L435" title="All 2 branches covered.">                        if (i == 1) {</span>
<span class="fc" id="L436">                            possibleNextCells[i] = getNextDiagonalCell(possibleCells[i].getNumber(), rightDirection);</span>
                        }
                    }
                }

<span class="fc bfc" id="L441" title="All 2 branches covered.">                for (int j = 0; j &lt; possibleNextCells.length; j++) {</span>

<span class="pc bpc" id="L443" title="1 of 2 branches missed.">                    if (possibleNextCells[j] != null) {</span>

<span class="fc bfc" id="L445" title="All 2 branches covered.">                        if (possibleNextCells[j].getNumber() == end) {</span>

<span class="fc" id="L447">                            eatenCheckerCell = possibleCells[j];</span>
                        }
                    }
                }

                // ho trovato la cella in cui mangiare la pedina
<span class="pc bpc" id="L453" title="1 of 2 branches missed.">                if (eatenCheckerCell != null) {</span>

<span class="fc" id="L455">                    Checker eatenChecker = eatenCheckerCell.getOccupierChecker();</span>

<span class="pc bpc" id="L457" title="1 of 2 branches missed.">                    if (eatenChecker != null) {</span>

<span class="pc bpc" id="L459" title="2 of 4 branches missed.">                        if (eatenChecker.getColor() != current.getColor() &amp;&amp; !eatenChecker.isBigChecker()) {</span>

<span class="fc" id="L461">                            numberEatenCheckerCell = eatenCheckerCell.getNumber();</span>
                        }
                    }
                }
            }
        }
<span class="fc" id="L467">        return numberEatenCheckerCell;</span>
    }

    private int checkerSimpleTake(final int start, final int end, final Player current) {

<span class="fc" id="L472">        int endCellNumber = NOT_VALID_CELL;</span>
<span class="fc" id="L473">        int eatCellNumber = checkerSimpleTakeControl(start, end, current);</span>

        // il controllo e' ok
<span class="pc bpc" id="L476" title="1 of 2 branches missed.">        if (eatCellNumber != NOT_VALID_CELL) {</span>

<span class="fc" id="L478">            CheckersComponent startCell = getCell(start);</span>
<span class="fc" id="L479">            CheckersComponent endCell = getCell(end);</span>
<span class="fc" id="L480">            CheckersComponent eatCell = getCell(eatCellNumber);</span>
<span class="fc" id="L481">            Checker movedChecker = startCell.getOccupierChecker();</span>

<span class="fc" id="L483">            eatCell.setOccupierChecker(null);</span>
<span class="fc" id="L484">            endCell.setOccupierChecker(movedChecker);</span>
<span class="fc" id="L485">            startCell.setOccupierChecker(null);</span>

<span class="fc bfc" id="L487" title="All 2 branches covered.">            if (current.getColor() == Game.getWhiteColor()) {</span>
<span class="fc" id="L488">                blackCheckers--;</span>
            } else {
<span class="fc" id="L490">                whiteCheckers--;</span>
            }
<span class="fc" id="L492">            endCellNumber = end;</span>
<span class="fc" id="L493">            setBigCheckerTable(end, movedChecker);</span>
        }
<span class="fc" id="L495">        String movement = start + &quot;x&quot; + end;</span>
<span class="fc" id="L496">        current.setMoves(movement);</span>
<span class="fc" id="L497">        return endCellNumber;</span>
    }

    public final int simpleTake(final String input, final Player current) {

<span class="fc" id="L502">        int endCellNumber = NOT_VALID_CELL;</span>
<span class="fc" id="L503">        int[] cellNumbers = getNumbersCells(input, TAKE_SEPARATOR);</span>

<span class="pc bpc" id="L505" title="1 of 2 branches missed.">        if (validInputNumbers(cellNumbers)) {</span>

<span class="fc" id="L507">            Checker movedChecker = getCell(cellNumbers[0]).getOccupierChecker();</span>

<span class="pc bpc" id="L509" title="1 of 2 branches missed.">            if (movedChecker != null) {</span>

<span class="fc bfc" id="L511" title="All 2 branches covered.">                if (!movedChecker.isBigChecker()) {</span>

<span class="fc" id="L513">                    endCellNumber = checkerSimpleTake(cellNumbers[0], cellNumbers[1], current);</span>
                } else {
<span class="fc" id="L515">                    endCellNumber = bigCheckerSimpleTake(cellNumbers[0], cellNumbers[1], current);</span>
                }
            }
        }
<span class="fc" id="L519">        return endCellNumber;</span>
    }

    private int bigCheckerSimpleTakeControl(final int start, final int end, final Player current) {

<span class="fc" id="L524">        int numberEatenCheckerCell = NOT_VALID_CELL;</span>

<span class="fc" id="L526">        CheckersComponent startCell = getCell(start);</span>
<span class="fc" id="L527">        CheckersComponent endCell = getCell(end);</span>
<span class="fc" id="L528">        Checker movedChecker = startCell.getOccupierChecker();</span>

<span class="pc bpc" id="L530" title="2 of 4 branches missed.">        if (movedChecker != null &amp;&amp; endCell.getOccupierChecker() == null) {</span>

<span class="pc bpc" id="L532" title="1 of 2 branches missed.">            if (movedChecker.getColor() == current.getColor()) {</span>

<span class="fc" id="L534">                CheckersComponent eatenCheckerCell = null;</span>
<span class="fc" id="L535">                final int numberPossibleCells = 4;</span>

<span class="fc" id="L537">                CheckersComponent[] possibleCells = new CheckersComponent[numberPossibleCells];</span>
<span class="fc" id="L538">                CheckersComponent[] possibleNextCells = new CheckersComponent[numberPossibleCells];</span>

<span class="fc" id="L540">                final int cell0 = 0;</span>
<span class="fc" id="L541">                final int cell1 = 1;</span>
<span class="fc" id="L542">                final int cell2 = 2;</span>
<span class="fc" id="L543">                final int cell3 = 3;</span>

                // devo contollare quattro celle ognuna con la cella successiva in diagonale
<span class="fc" id="L546">                possibleCells[cell0] = getNextDiagonalCell(start, UPPER_LEFT_CELL);</span>
<span class="fc" id="L547">                possibleCells[cell1] = getNextDiagonalCell(start, UPPER_RIGHT_CELL);</span>
<span class="fc" id="L548">                possibleCells[cell2] = getNextDiagonalCell(start, LOWER_LEFT_CELL);</span>
<span class="fc" id="L549">                possibleCells[cell3] = getNextDiagonalCell(start, LOWER_RIGHT_CELL);</span>

<span class="fc bfc" id="L551" title="All 2 branches covered.">                for (int i = 0; i &lt; possibleCells.length; i++) {</span>

<span class="fc bfc" id="L553" title="All 2 branches covered.">                    if (possibleCells[i] != null) {</span>

<span class="fc bfc" id="L555" title="All 2 branches covered.">                        if (i == cell0) {</span>
<span class="fc" id="L556">                            possibleNextCells[i] = getNextDiagonalCell(possibleCells[i].getNumber(), UPPER_LEFT_CELL);</span>
                        }

<span class="fc bfc" id="L559" title="All 2 branches covered.">                        if (i == cell1) {</span>
<span class="fc" id="L560">                            possibleNextCells[i] = getNextDiagonalCell(possibleCells[i].getNumber(), UPPER_RIGHT_CELL);</span>
                        }

<span class="fc bfc" id="L563" title="All 2 branches covered.">                        if (i == cell2) {</span>
<span class="fc" id="L564">                            possibleNextCells[i] = getNextDiagonalCell(possibleCells[i].getNumber(), LOWER_LEFT_CELL);</span>
                        }

<span class="fc bfc" id="L567" title="All 2 branches covered.">                        if (i == cell3) {</span>
<span class="fc" id="L568">                            possibleNextCells[i] = getNextDiagonalCell(possibleCells[i].getNumber(), LOWER_RIGHT_CELL);</span>
                        }
                    }
                }

<span class="fc bfc" id="L573" title="All 2 branches covered.">                for (int j = 0; j &lt; possibleNextCells.length; j++) {</span>

<span class="fc bfc" id="L575" title="All 2 branches covered.">                    if (possibleNextCells[j] != null) {</span>

<span class="fc bfc" id="L577" title="All 2 branches covered.">                        if (possibleNextCells[j].getNumber() == end) {</span>

<span class="fc" id="L579">                            eatenCheckerCell = possibleCells[j];</span>
                        }
                    }
                }

<span class="pc bpc" id="L584" title="1 of 2 branches missed.">                if (eatenCheckerCell != null) {</span>

<span class="fc" id="L586">                    Checker eatenChecker = eatenCheckerCell.getOccupierChecker();</span>

<span class="pc bpc" id="L588" title="1 of 2 branches missed.">                    if (eatenChecker != null) {</span>

<span class="pc bpc" id="L590" title="1 of 2 branches missed.">                        if (eatenChecker.getColor() != current.getColor()) {</span>

<span class="fc" id="L592">                            numberEatenCheckerCell = eatenCheckerCell.getNumber();</span>
                        }
                    }
                }
            }
        }
<span class="fc" id="L598">        return numberEatenCheckerCell;</span>
    }

    private int bigCheckerSimpleTake(final int start, final int end, final Player current) {

<span class="fc" id="L603">        int endCellNumber = NOT_VALID_CELL;</span>

<span class="fc" id="L605">        int eatCellNumber = bigCheckerSimpleTakeControl(start, end, current);</span>

        // il controllo e' ok
<span class="pc bpc" id="L608" title="1 of 2 branches missed.">        if (eatCellNumber != NOT_VALID_CELL) {</span>

<span class="fc" id="L610">            CheckersComponent startCell = getCell(start);</span>
<span class="fc" id="L611">            CheckersComponent endCell = getCell(end);</span>
<span class="fc" id="L612">            CheckersComponent eatCell = getCell(eatCellNumber);</span>
<span class="fc" id="L613">            Checker movedChecker = startCell.getOccupierChecker();</span>

<span class="fc" id="L615">            eatCell.setOccupierChecker(null);</span>
<span class="fc" id="L616">            endCell.setOccupierChecker(movedChecker);</span>
<span class="fc" id="L617">            startCell.setOccupierChecker(null);</span>

<span class="fc bfc" id="L619" title="All 2 branches covered.">            if (current.getColor() == Game.getWhiteColor()) {</span>
<span class="fc" id="L620">                blackCheckers--;</span>
            } else {
<span class="fc" id="L622">                whiteCheckers--;</span>
            }
<span class="fc" id="L624">            endCellNumber = end;</span>

        }
<span class="fc" id="L627">        String movement = start + &quot;x&quot; + end;</span>
<span class="fc" id="L628">        current.setMoves(movement);</span>
<span class="fc" id="L629">        return endCellNumber;</span>
    }

    private String[] getDoubleTakeInputs(final String input, final char separator) {

<span class="fc" id="L634">        String[] inputTake1 = new String[2];</span>

<span class="fc" id="L636">        final int doubleTakeNum = 3;</span>

<span class="pc bpc" id="L638" title="1 of 2 branches missed.">        if (moveType(input) == doubleTakeNum) {</span>

<span class="fc" id="L640">            int i = 0;</span>
<span class="fc" id="L641">            int xcount = 0;</span>

<span class="fc" id="L643">            int startFirstImput = 0;</span>
<span class="fc" id="L644">            int startSecondInput = -1;</span>

<span class="pc bpc" id="L646" title="1 of 2 branches missed.">            while (i &lt; input.length()) {</span>
<span class="fc bfc" id="L647" title="All 2 branches covered.">                if (input.charAt(i) == TAKE_SEPARATOR) {</span>
<span class="fc" id="L648">                    xcount++;</span>
                }

<span class="fc bfc" id="L651" title="All 4 branches covered.">                if (xcount == 1 &amp;&amp; startSecondInput == -1) {</span>
<span class="fc" id="L652">                    startSecondInput = i + 1;</span>
                }

<span class="fc bfc" id="L655" title="All 2 branches covered.">                if (xcount == 2) {</span>

<span class="fc" id="L657">                    inputTake1[0] = input.substring(startFirstImput, i);</span>
<span class="fc" id="L658">                    inputTake1[1] = input.substring(startSecondInput, input.length());</span>
<span class="fc" id="L659">                    break;</span>
                }

<span class="fc" id="L662">                i++;</span>
            }

        }
<span class="fc" id="L666">        return inputTake1;</span>
    }

    private int doubleTakeChecker(final String input, final Player current) {

<span class="fc" id="L671">        int endCellNumber = NOT_VALID_CELL;</span>

<span class="fc" id="L673">        String[] moves = getDoubleTakeInputs(input, TAKE_SEPARATOR);</span>
<span class="fc" id="L674">        int[] numbersMoveOne = getNumbersCells(moves[0], TAKE_SEPARATOR);</span>

<span class="pc bpc" id="L676" title="1 of 2 branches missed.">        if (validInputNumbers(numbersMoveOne)) {</span>

            // il controllo sulla prima presa e' ok
<span class="pc bpc" id="L679" title="1 of 2 branches missed.">            if (checkerSimpleTakeControl(numbersMoveOne[0], numbersMoveOne[1], current) != NOT_VALID_CELL) {</span>

                // inserisco la pedina fittizia per simulare la seconda presa
<span class="fc" id="L682">                Checker controlChecker = getCell(numbersMoveOne[0]).getOccupierChecker();</span>
<span class="fc" id="L683">                CheckersComponent controlCell = getCell(numbersMoveOne[1]);</span>
<span class="fc" id="L684">                controlCell.setOccupierChecker(controlChecker);</span>

<span class="fc" id="L686">                int[] numbersMoveTwo = getNumbersCells(moves[1], TAKE_SEPARATOR);</span>

<span class="pc bpc" id="L688" title="1 of 2 branches missed.">                if (validInputNumbers(numbersMoveTwo)</span>
<span class="pc bpc" id="L689" title="1 of 2 branches missed.">                        &amp;&amp; checkerSimpleTakeControl(numbersMoveTwo[0], numbersMoveTwo[1], current) != NOT_VALID_CELL) {</span>

<span class="fc" id="L691">                    controlCell.setOccupierChecker(null);</span>
<span class="fc" id="L692">                	current.setMoves(input);</span>
<span class="fc" id="L693">                    checkerSimpleTake(numbersMoveOne[0], numbersMoveOne[1], current);</span>
<span class="fc" id="L694">                    endCellNumber = checkerSimpleTake(numbersMoveTwo[0], numbersMoveTwo[1], current);</span>


                } else {
<span class="nc" id="L698">                    controlCell.setOccupierChecker(null);</span>
                }
            }
        }

<span class="fc" id="L703">        return endCellNumber;</span>
    }

    private int doubleTakeBigChecker(final String input, final Player current) {

<span class="fc" id="L708">        int endCellNumber = NOT_VALID_CELL;</span>

<span class="fc" id="L710">        String[] moves = getDoubleTakeInputs(input, TAKE_SEPARATOR);</span>
<span class="fc" id="L711">        int[] numbersMoveOne = getNumbersCells(moves[0], TAKE_SEPARATOR);</span>

<span class="pc bpc" id="L713" title="1 of 2 branches missed.">        if (validInputNumbers(numbersMoveOne)) {</span>

<span class="pc bpc" id="L715" title="1 of 2 branches missed.">            if (bigCheckerSimpleTakeControl(numbersMoveOne[0], numbersMoveOne[1], current) != NOT_VALID_CELL) {</span>

                // inserisco la pedina fittizia per simulare la seconda presa
<span class="fc" id="L718">                Checker controlChecker = getCell(numbersMoveOne[0]).getOccupierChecker();</span>
<span class="fc" id="L719">                CheckersComponent controlCell = getCell(numbersMoveOne[1]);</span>
<span class="fc" id="L720">                controlCell.setOccupierChecker(controlChecker);</span>

<span class="fc" id="L722">                int[] numbersMoveTwo = getNumbersCells(moves[1], TAKE_SEPARATOR);</span>

<span class="pc bpc" id="L724" title="1 of 2 branches missed.">                if (validInputNumbers(numbersMoveTwo)) {</span>

<span class="fc" id="L726">                    final int nmt0 = numbersMoveTwo[0];</span>
<span class="fc" id="L727">                    final int nmt1 = numbersMoveTwo[1];</span>

<span class="pc bpc" id="L729" title="1 of 2 branches missed.">                    if (bigCheckerSimpleTakeControl(nmt0, nmt1, current) != NOT_VALID_CELL) {</span>

<span class="fc" id="L731">                        controlCell.setOccupierChecker(null);</span>

<span class="fc" id="L733">                        bigCheckerSimpleTake(numbersMoveOne[0], numbersMoveOne[1], current);</span>
<span class="fc" id="L734">                        endCellNumber = bigCheckerSimpleTake(numbersMoveTwo[0], numbersMoveTwo[1], current);</span>
                    }
<span class="fc" id="L736">                    current.setMoves(input);</span>
<span class="fc" id="L737">                } else {</span>
<span class="nc" id="L738">                    controlCell.setOccupierChecker(null);</span>
                }
            }
        }

<span class="fc" id="L743">        return endCellNumber;</span>
    }

    public final int doubleTake(final String input, final Player current) {

<span class="fc" id="L748">        int endCellNumber = NOT_VALID_CELL;</span>

<span class="fc" id="L750">        int[] numbersDoubleTake = getNumbersCells(input, TAKE_SEPARATOR);</span>
<span class="fc" id="L751">        Checker movedChecker = getCell(numbersDoubleTake[0]).getOccupierChecker();</span>

<span class="fc bfc" id="L753" title="All 2 branches covered.">        if (!movedChecker.isBigChecker()) {</span>

<span class="fc" id="L755">            endCellNumber = doubleTakeChecker(input, current);</span>
        } else {
<span class="fc" id="L757">            endCellNumber = doubleTakeBigChecker(input, current);</span>
        }

<span class="fc" id="L760">        return endCellNumber;</span>
    }

    public final void resetTable() {
<span class="nc" id="L764">        super.reset();</span>
<span class="nc" id="L765">        whiteCheckers = CHECKERS_NUMBER;</span>
<span class="nc" id="L766">        blackCheckers = CHECKERS_NUMBER;</span>
<span class="nc" id="L767">   }</span>
    private static int charCount(final String s, final char c) {

<span class="fc bfc" id="L770" title="All 2 branches covered.">        return (int) s.chars().filter(ch -&gt; ch == c).count();</span>
    }

    public static int moveType(final String userInput) {

<span class="fc" id="L775">        int type = 0;</span>

<span class="fc bfc" id="L777" title="All 2 branches covered.">        if (charCount(userInput, GameCheckersTable.MOVE_SEPARATOR) == 1</span>
<span class="pc bpc" id="L778" title="1 of 2 branches missed.">        		&amp;&amp; charCount(userInput, GameCheckersTable.TAKE_SEPARATOR) == 0) {</span>

<span class="fc" id="L780">            type = MOVE_TYPE;</span>
        }

<span class="fc bfc" id="L783" title="All 2 branches covered.">        if (charCount(userInput, GameCheckersTable.TAKE_SEPARATOR) == 1</span>
<span class="pc bpc" id="L784" title="1 of 2 branches missed.">        		&amp;&amp; charCount(userInput, GameCheckersTable.MOVE_SEPARATOR) == 0) {</span>

<span class="fc" id="L786">            type = SIMPLE_TAKE_TYPE;</span>
        }

<span class="fc bfc" id="L789" title="All 2 branches covered.">        if (charCount(userInput, GameCheckersTable.TAKE_SEPARATOR) == 2</span>
<span class="pc bpc" id="L790" title="1 of 2 branches missed.">        		&amp;&amp; charCount(userInput, GameCheckersTable.MOVE_SEPARATOR) == 0) {</span>

<span class="fc" id="L792">            type = DOUBLE_TAKE_TYPE;</span>
        }
<span class="fc" id="L794">        return type;</span>
    }

    public static void showTakes(final GameCheckersTable currentTable) {

<span class="nc" id="L799">    	final int whiteTakes = 12 - currentTable.getWhiteCheckers();</span>
<span class="nc" id="L800">    	final int blackTakes = 12 - currentTable.getBlackCheckers();</span>

<span class="nc" id="L802">    	System.out.print(&quot;Nero: &quot;);</span>

<span class="nc bnc" id="L804" title="All 2 branches missed.">    	for (int i = 0; i &lt; whiteTakes; i++) {</span>

<span class="nc" id="L806">    		System.out.print('\u26c0');</span>
    	}

<span class="nc" id="L809">       	System.out.println(&quot; &quot;);</span>
<span class="nc" id="L810">    	System.out.print(&quot;Bianco: &quot;);</span>

<span class="nc bnc" id="L812" title="All 2 branches missed.">    	for (int i = 0; i &lt; blackTakes; i++) {</span>

<span class="nc" id="L814">    		System.out.print('\u26c2');</span>
    	}
<span class="nc" id="L816">     	System.out.println(&quot; &quot;);</span>
<span class="nc" id="L817">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>